__NUXT_JSONP__("/post/flat-data-r", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV){return {data:[{post:{slug:"flat-data-r",description:"Fetch and clean data automatically with GitHub Actions + R",title:"Including R in your Flat Data Workflow",img:"flat-data-r\u002Fheader.png",img_alt:Z,date:"2021-05-30",featured:true,toc:[{id:aj,depth:I,text:ak},{id:al,depth:I,text:am},{id:an,depth:3,text:"01. Setup flat.yml"},{id:ao,depth:I,text:ap},{id:aq,depth:I,text:ar},{id:as,depth:I,text:at}],body:{type:"root",children:[{type:b,tag:m,props:{},children:[{type:a,value:au},{type:b,tag:j,props:{href:"https:\u002F\u002Focto.github.com\u002F",rel:[n,o,p],target:q},children:[{type:a,value:"GitHub OCTO team"}]},{type:a,value:" recently released their first project: "},{type:b,tag:j,props:{href:_,rel:[n,o,p],target:q},children:[{type:b,tag:z,props:{},children:[{type:a,value:av}]}]},{type:a,value:". The project aims to offer \"a simple pattern for bringing working datasets into your repositories and versioning them.\" And it succeeds in doing so! I recently incorporated Flat Data into "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fconnorrothschild\u002Fpolice-killings",rel:[n,o,p],target:q},children:[{type:a,value:"one of my projects"}]},{type:a,value:", allowing me to finally stop manually updating the data on a semiregular basis (yikes!). While working, I couldn't find any documentation on using R with Flat Data. Here, I'll explain the steps I took to incorporate R scripts into a Flat Data pipeline."}]},{type:a,value:f},{type:b,tag:"info-box",props:{},children:[{type:a,value:D},{type:b,tag:"template",props:{"#info-box":""},children:[],content:[{type:a,value:f},{type:b,tag:m,props:{},children:[{type:b,tag:z,props:{},children:[{type:a,value:"Note:"}]},{type:a,value:" If you want to follow along, the GitHub repo can be found "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fconnorrothschild\u002Fflat-demo-r-processing\u002F",rel:[n,o,p],target:q},children:[{type:a,value:"here"}]},{type:a,value:y}]},{type:a,value:D}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:J,props:{id:aj},children:[{type:b,tag:j,props:{href:"#whats-flat-data",ariaHidden:E,tabIndex:F},children:[{type:b,tag:c,props:{className:[G,H]},children:[]}]},{type:a,value:ak}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:b,tag:j,props:{href:_,rel:[n,o,p],target:q},children:[{type:a,value:av}]},{type:a,value:" solves the problem of carrying out the same repetitive tasks—retrieving, cleaning, and then republishing data—that commonly affects developers who want to present rapidly updating data (for example, COVID-19 data that updates daily). And although alternative solutions exist, Flat Data is easy, intuitive, and integrated directly with your GitHub repository (via "},{type:b,tag:j,props:{href:_,rel:[n,o,p],target:q},children:[{type:a,value:"GitHub"}]},{type:a,value:aw}]},{type:a,value:f},{type:b,tag:ax,props:{src:"post\u002Fflat-data-r\u002Fflat-diagram.png",alt:"A diagram showcasing a common Flat Data workflow"},children:[{type:a,value:f}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"The idea, as seen above, is essentially to read in data ("},{type:b,tag:A,props:{},children:[{type:a,value:"data.json"}]},{type:a,value:"), conduct some postprocessing ("},{type:b,tag:A,props:{},children:[{type:a,value:"process.js"}]},{type:a,value:"), and output some better data ("},{type:b,tag:A,props:{},children:[{type:a,value:"processed-data.json"}]},{type:a,value:")."}]},{type:a,value:f},{type:b,tag:J,props:{id:al},children:[{type:b,tag:j,props:{href:"#doing-it-in-r",ariaHidden:E,tabIndex:F},children:[{type:b,tag:c,props:{className:[G,H]},children:[]}]},{type:a,value:am}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"The most essential step of a Flat Data project is "},{type:b,tag:A,props:{},children:[{type:a,value:"postprocessing"}]},{type:a,value:". This occurs "},{type:b,tag:z,props:{},children:[{type:a,value:"after data retrieval"}]},{type:a,value:ay},{type:b,tag:z,props:{},children:[{type:a,value:"before data output"}]},{type:a,value:", and it can be done in a few different languages. By default, the OCTO team's "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fgithubocto\u002Fflat-postprocessing\u002Ftree\u002Fmain\u002Fexamples",rel:[n,o,p],target:q},children:[{type:a,value:"examples"}]},{type:a,value:" are done in JavaScript\u002FTypeScript, and one user has given an example of postprocessing in "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fpierrotsmnrd\u002Fflat_data_py_example",rel:[n,o,p],target:q},children:[{type:a,value:"Python"}]},{type:a,value:". To the best of my knowledge, though, there aren't any examples of including R in the postprocessing stage, hence the reason for this post!"}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:b,tag:z,props:{},children:[{type:a,value:"Using R in a Flat Data pipeline is as simple as installing the necessary packages and then sourcing your R cleaning script from a postprocessing TypeScript file."}]},{type:a,value:" Let's explore how that works."}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"We'll be grabbing data from the "},{type:b,tag:j,props:{href:"https:\u002F\u002Fmappingpoliceviolence.org\u002F",rel:[n,o,p],target:q},children:[{type:a,value:"Mapping Police Violence"}]},{type:a,value:" homepage, tidying it up, and then republishing it. (This cleaned data is the source for my "},{type:b,tag:j,props:{href:"https:\u002F\u002Fconnorrothschild.github.io\u002Fpolice-killings\u002F",rel:[n,o,p],target:q},children:[{type:a,value:"visualization"}]},{type:a,value:" on police violence.)  Here's a sample of the final data output:"}]},{type:a,value:f},{type:b,tag:"iframe",props:{src:"https:\u002F\u002Fflatgithub.com\u002Fconnorrothschild\u002Fflat-demo-r-processing?filename=sample.csv&sha=585d7221d2712494195dea616bac68dc864025b1",loading:"lazy",style:"height: 90vh;",width:"100%"},children:[]},{type:a,value:f},{type:b,tag:"h3",props:{id:an},children:[{type:b,tag:j,props:{href:"#01-setup-flatyml",ariaHidden:E,tabIndex:F},children:[{type:b,tag:c,props:{className:[G,H]},children:[]}]},{type:a,value:"01. Setup "},{type:b,tag:r,props:{},children:[{type:a,value:$}]}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"The first step in any Flat Data pipeline is to create "},{type:b,tag:r,props:{},children:[{type:a,value:".github\u002Fworkflows\u002Fflat.yml"}]},{type:a,value:", which will include the configuration for your project. You can do so by using GitHub's "},{type:b,tag:j,props:{href:"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=GitHubOCTO.flat",rel:[n,o,p],target:q},children:[{type:a,value:"VSCode extension"}]},{type:a,value:", or by creating your own YAML file manually. The YAML file we use in this project is remarkably similar to the "},{type:b,tag:j,props:{href:az,rel:[n,o,p],target:q},children:[{type:a,value:"boilerplate"}]},{type:a,value:" file, with a few differences:"}]},{type:a,value:f},{type:b,tag:N,props:{className:[O]},children:[{type:b,tag:c,props:{className:[P]},children:[{type:a,value:$}]},{type:b,tag:Q,props:{className:[R,aA]},children:[{type:b,tag:r,props:{},children:[{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" Update data\n"},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"on"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"cron"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" 0 0 * * * "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Runs daily. See https:\u002F\u002Fcrontab.cronhub.io\u002F"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"workflow_dispatch"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"push"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"branches"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:" main "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Or master, or whatever branch you'd like to 'watch'"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"jobs"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"scheduled"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"runs-on"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" ubuntu"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:"latest\n    "},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"steps"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# This step installs Deno, which is a Javascript runtime"}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" Setup deno\n        "},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:ad}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" denoland\u002Fsetup"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:"deno@main\n        "},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"deno-version"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" v1.x\n      "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Check out the repository so it can read the files inside of it and do other operations"}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" Check out repo\n        "},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:ad}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" actions\u002Fcheckout@v2\n      "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# The Flat Action step. We fetch the data in the http_url and save it as downloaded_filename"}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:B}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" Fetch data\n        "},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:ad}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" githubocto\u002Fflat@v2\n        "},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" https"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"\u002F\u002Fmappingpoliceviolence.org\u002Fs\u002FMPVDatasetDownload.xlsx "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# File to download"}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:"downloaded_filename"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" raw.xlsx "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Name of downloaded file"}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" .\u002Fpostprocess.ts "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Script to run upon download completion"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"The tweaks you would make to this workflow are most likely in "},{type:b,tag:r,props:{},children:[{type:a,value:aD}]},{type:a,value:ay},{type:b,tag:r,props:{},children:[{type:a,value:aB}]},{type:a,value:". To confirm, visit GitHub's "},{type:b,tag:j,props:{href:az,rel:[n,o,p],target:q},children:[{type:a,value:"documentation"}]},{type:a,value:y}]},{type:a,value:f},{type:b,tag:J,props:{id:ao},children:[{type:b,tag:j,props:{href:"#02-postprocess",ariaHidden:E,tabIndex:F},children:[{type:b,tag:c,props:{className:[G,H]},children:[]}]},{type:a,value:ap}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"We pick up at the last line of code in the previous chunk:"}]},{type:a,value:f},{type:b,tag:N,props:{className:[O]},children:[{type:b,tag:c,props:{className:[P]},children:[{type:a,value:$}]},{type:b,tag:Q,props:{className:[R,aA]},children:[{type:b,tag:r,props:{},children:[{type:b,tag:c,props:{className:[d,k,l]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" .\u002Fpostprocess.ts \n"}]}]}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"Here, we reference a TypeScript file titled "},{type:b,tag:r,props:{},children:[{type:a,value:L}]},{type:a,value:". Upon completion of the data download, GitHub will run "},{type:b,tag:A,props:{},children:[{type:a,value:"this script"}]},{type:a,value:" for any additional processing steps. This file must be a "},{type:b,tag:r,props:{},children:[{type:a,value:".js"}]},{type:a,value:" or "},{type:b,tag:r,props:{},children:[{type:a,value:".ts"}]},{type:a,value:" file."}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"Those who are skilled in data wrangling with JavaScript might be able to write their additional processing "},{type:b,tag:A,props:{},children:[{type:a,value:"in JavaScript itself"}]},{type:a,value:", but few of us are skilled in data wrangling with JavaScript. Moreover, some users want to migrate their existing projects and workflows to Flat Data, and so including languages other than JavaScript (in this case, R) is essential."}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:au},{type:b,tag:r,props:{},children:[{type:a,value:L}]},{type:a,value:" file I use in my workflow looks like this (it might help to see how "},{type:b,tag:j,props:{href:"https:\u002F\u002Fdeno.land\u002Fmanual@v1.10.2\u002Fexamples\u002Fsubprocess",rel:[n,o,p],target:q},children:[{type:a,value:"Deno works"}]},{type:a,value:aw}]},{type:a,value:f},{type:b,tag:N,props:{className:[O]},children:[{type:b,tag:c,props:{className:[P]},children:[{type:a,value:L}]},{type:b,tag:Q,props:{className:[R,"language-js"]},children:[{type:b,tag:r,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\u002F\u002F 1. Install necessary packages"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:aF}]},{type:a,value:" r_install "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,V,W,X]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:g}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"'sudo'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:aL}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"'-e'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"install.packages(c('dplyr', 'readxl', 'readr', 'lubridate', 'stringr'))\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aM}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:C},{type:b,tag:c,props:{className:[d,U,aN]},children:[{type:a,value:aO}]},{type:a,value:" r_install"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,V,W,X]},children:[{type:a,value:aP}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:C},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\u002F\u002F 2. Forward the execution to the R script"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:aF}]},{type:a,value:" r_run "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,V,W,X]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ab}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:g}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:aL}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"'.\u002Fclean.R'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aM}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:C},{type:b,tag:c,props:{className:[d,U,aN]},children:[{type:a,value:aO}]},{type:a,value:" r_run"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,V,W,X]},children:[{type:a,value:aP}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"The above script is rather simple: it 1) installs packages, and 2) runs the processing script, titled "},{type:b,tag:r,props:{},children:[{type:a,value:ae}]},{type:a,value:y}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"The first step is important.  "},{type:b,tag:z,props:{},children:[{type:a,value:"Package management was the biggest issue I ran into while setting up this workflow; if you're having issues, pay attention to this step."}]},{type:a,value:" You'll need to identify all the packages that are required in your R processing script, but you can't install those packages "},{type:b,tag:A,props:{},children:[{type:a,value:"in the script itself"}]},{type:a,value:", due to virtual machine permissions. You instead have to run them via the command line, using "},{type:b,tag:r,props:{},children:[{type:a,value:aQ}]},{type:a,value:", as I do above (in step 1)."}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"The command "},{type:b,tag:r,props:{},children:[{type:a,value:aQ}]},{type:a,value:" precedes any regular function or command that you would run in an R script. It executes those commands via the command line, rather than within a script. (We add sudo to overcome system user permission problems.) For more, see "},{type:b,tag:j,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F18306362\u002Frun-r-script-from-command-line",rel:[n,o,p],target:q},children:[{type:a,value:"this page"}]},{type:a,value:y}]},{type:a,value:f},{type:b,tag:J,props:{id:aq},children:[{type:b,tag:j,props:{href:"#03-clean-the-data",ariaHidden:E,tabIndex:F},children:[{type:b,tag:c,props:{className:[G,H]},children:[]}]},{type:a,value:ar}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"My "},{type:b,tag:r,props:{},children:[{type:a,value:ae}]},{type:a,value:" script, which I reference at the bottom of "},{type:b,tag:r,props:{},children:[{type:a,value:L}]},{type:a,value:" looks like this:"}]},{type:a,value:f},{type:b,tag:N,props:{className:[O]},children:[{type:b,tag:c,props:{className:[P]},children:[{type:a,value:ae}]},{type:b,tag:Q,props:{className:[R,"language-r"]},children:[{type:b,tag:r,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Load libraries"}]},{type:a,value:aR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"dplyr"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:aR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"stringr"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:C},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Read in data, with the same name that we specified in `flat.yml`"}]},{type:a,value:"\nraw_data "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aS}]},{type:a,value:" readxl"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:af}]},{type:a,value:"read_excel"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\".\u002Fraw.xlsx\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:C},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# All the processing!"}]},{type:a,value:"\nclean_data "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aS}]},{type:a,value:" raw_data "},{type:b,tag:c,props:{className:[d,ag,h]},children:[{type:a,value:ah}]},{type:a,value:" \n  rename"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Date\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `Date of Incident "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"month"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ai}]},{type:a,value:"day"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ai}]},{type:a,value:aT},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:"`"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Link\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `Link to news article or photo of official document`"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Armed Status\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `Armed"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ai}]},{type:a,value:"Unarmed Status`"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Age\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `Victim's age` "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Race\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `Victim's race`"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Sex\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `Victim's gender`"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Image\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `URL of image of victim`"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"Name\""}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" `Victim's name`"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,ag,h]},children:[{type:a,value:ah}]},{type:a,value:" \n  mutate"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"Zipcode "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" as.character"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"Zipcode"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:"\n         Year "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" lubridate"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:af}]},{type:a,value:aT},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:"\n         Sex "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:x}]},{type:a,value:" ifelse"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"is.na"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"Sex"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"'Unknown'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:" Sex"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,ag,h]},children:[{type:a,value:ah}]},{type:a,value:" \n  arrange"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:C},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"### Additional processing goes here..."}]},{type:a,value:C},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"# Output data"}]},{type:a,value:"\nreadr"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:af}]},{type:a,value:"write_csv"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"clean_data"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\".\u002Foutput.csv\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"Obviously, the content in the above cleaning script is irrelevant. It functions as any other R script would: it reads in data (based on the data we downloaded in "},{type:b,tag:r,props:{},children:[{type:a,value:L}]},{type:a,value:"), does some cleaning, and then outputs the new data. The "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fconnorrothschild\u002Fflat-demo-r-processing\u002Fblob\u002Fmaster\u002Fclean.R",rel:[n,o,p],target:q},children:[{type:a,value:"real script"}]},{type:a,value:" is around 55 lines. Now you know why keeping the postprocessing in R was preferable!"}]},{type:a,value:f},{type:b,tag:J,props:{id:as},children:[{type:b,tag:j,props:{href:"#in-sum",ariaHidden:E,tabIndex:F},children:[{type:b,tag:c,props:{className:[G,H]},children:[]}]},{type:a,value:at}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"Upon completing these steps and pushing the above to a repository, GitHub will automatically set up the action and run it on a daily basis. You can then examine the logs for each run in the "},{type:b,tag:z,props:{},children:[{type:a,value:"Actions"}]},{type:a,value:" tab. This tab will be helpful for debugging, and you can force workflow executions manually here as well. In sum, the process of carrying out a GitHub Flat Data workflow, with the addition of an R postprocessing script, looks something like this:"}]},{type:a,value:f},{type:b,tag:ax,props:{src:"post\u002Fflat-data-r\u002Fheader.png",alt:"Diagram of flat data processing in R"},children:[{type:a,value:f}]},{type:a,value:f},{type:b,tag:m,props:{},children:[{type:a,value:"Thanks for reading! You might learn more by perusing the "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fconnorrothschild\u002Fflat-demo-r-processing",rel:[n,o,p],target:q},children:[{type:a,value:"GitHub repository"}]},{type:a,value:" that accompanies this post; otherwise, please send any questions via "},{type:b,tag:j,props:{href:"https:\u002F\u002Ftwitter.com\u002FCL_Rothschild",rel:[n,o,p],target:q},children:[{type:a,value:"Twitter"}]},{type:a,value:" 🙂"}]}]},dir:"\u002Fposts",path:"\u002Fposts\u002Fflat-data-r",extension:".md",createdAt:"2021-12-16T21:41:20.782Z",updatedAt:"2021-12-16T21:41:20.783Z"},prev:{slug:"nuxt-blog-starter",title:"Announcing the Nuxt Blog Starter",img:"nuxt-blog-starter\u002Fheader.png",img_alt:Z},next:{slug:"svelte-and-d3",title:"Making Visualizations Literally with Svelte & D3",img:"svelte-and-d3\u002Fheader.png",img_alt:Z}}],fetch:{},mutations:void 0}}("text","element","span","token","punctuation","\n",":","operator"," ","a","key","atrule","p","nofollow","noopener","noreferrer","_blank","code","string","(",",",")","comment","=",".","strong","em","-","\n\n","\n  ","true",-1,"icon","icon-link",2,"h2","\n      ","postprocess.ts"," \n         ","div","nuxt-content-highlight","filename","pre","line-numbers","name","\n          ","keyword","method","function","property-access",";","Blog post header image","https:\u002F\u002Focto.github.com\u002Fprojects\u002Fflat-data","flat.yml","\n    ","{","}","uses","clean.R","::","percent-operator","%\u003E%","\u002F","whats-flat-data","What's Flat Data?","doing-it-in-r","Doing it in R","01-setup-flatyml","02-postprocess","02. Postprocess","03-clean-the-data","03. Clean the data!","in-sum","In Sum","The ","Flat Data","):","inline-image"," and ","https:\u002F\u002Fgithub.com\u002Fmarketplace\u002Factions\u002Fflat-data","language-yaml","schedule","with","http_url","postprocess","const","maybe-class-name","Deno","run","\n    cmd","[","'Rscript'","]","control-flow","await","status","sudo Rscript -e","\nlibrary","\u003C-","year","\n         ","Date")));